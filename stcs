local RunService = game:GetService("RunService")
local Players = game:GetService("Players")

local player = Players.LocalPlayer
local camera = workspace.CurrentCamera

local zone = workspace.Terrain.Spawn:FindFirstChild("SafePlate")
if not zone then return end

local ZonePos = zone.Position
local ZoneSize = zone.Size
local area = Vector3.new(ZoneSize.X, 0, ZoneSize.Z) / 2

local XZ = {
	minX = ZonePos.X - area.X,
	maxX = ZonePos.X + area.X,
	minZ = ZonePos.Z - area.Z,
	maxZ = ZonePos.Z + area.Z
}

local toggle = true

local UpdateCamAim = function()
	if not toggle then return end
	
	local character = player.Character
	local rootpart = character and character:FindFirstChild("HumanoidRootPart")
	local humanoid = character and character:FindFirstChild("Humanoid")
	
	if not character or not rootpart or not humanoid then return end

	local position = rootpart.Position
	if position.X >= XZ.minX and position.X <= XZ.maxX and position.Z >= XZ.minZ and position.Z <= XZ.maxZ then return end

	-- Find nearest target within range
	local nearestTarget = nil
	local nearestDistance = 15
	
	for _, Player in pairs(Players:GetPlayers()) do
		if Player.Name ~= player.Name then
			local otherchar = Player.Character
			local otherroot = otherchar and otherchar:FindFirstChild("HumanoidRootPart")
			local otherhum = otherchar and otherchar:FindFirstChild("Humanoid")
			
			if not otherchar or not otherroot or not otherhum then continue end
			
			if otherhum.Health <= 0 then continue end
			if humanoid.Health <= 0 then return end

			local distance = (otherroot.Position - rootpart.Position).Magnitude
			
			if distance <= nearestDistance then
				local RightArm = otherchar:FindFirstChild("Right Arm")
				if RightArm then
					nearestDistance = distance
					nearestTarget = {player = Player, rightArm = RightArm}
				end
			end
		end
	end
	
	-- Only update camera if we have a target
	if nearestTarget then
		local cameraPos = camera.CFrame.Position
		local targetPos = nearestTarget.rightArm.Position
		
		-- Calculate horizontal direction from camera to right arm (ignore Y component)
		local direction = Vector3.new(targetPos.X - cameraPos.X, 0, targetPos.Z - cameraPos.Z).Unit
		
		-- Create new CFrame that maintains current height but rotates horizontally
		local lookAtPosition = cameraPos + direction
		local NewCFrame = CFrame.new(cameraPos, lookAtPosition)
		
		camera.CFrame = NewCFrame
	end
end

RunService.Heartbeat:Connect(function()
	UpdateCamAim()
end)
